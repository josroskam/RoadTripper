<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assignment 2 and 3</title>
    <style>
        label {
            display: inline-block;
            width: 100px;
            vertical-align: top;
        }
    </style>
</head>

<body>

    
    <h1>Post a new Article</h1>
    <form id="myForm">
        <label for="title">Title:</label><input type="text" id="title" />
        <br>
        <label for="content">Content:</label><textarea id="content" cols="40"></textarea>
        <br>
        <button type="button" onclick="sendForm();">Send!</button>
    </form>

    <h1>Articles</h1>
    <div id="articles">
        <p>Articles go here...</p>
    </div>
    <script>

        function loadData() {

            // Assignment 2

            // use fetch to retrieve the articles from http://localhost/api/article
            // Note: Assignment 1 has to be completed before this works!

            fetch('http://localhost/api/article')
            .then(result => result.json().then(articles =>{

                const articlesDiv = document.getElementById('articles');

                articles.forEach(element => {
                    const title = document.createElement('h2');
                    title.innerText = element.title;
                    articlesDiv.append(title);
                });
                console.log(articles)

            }));

            // Create an H2 with the title and a p with the content for every article
            // And display the articles on the page by appending them to the 'articles' div
            const newDiv = document.createElement('div');
            const newContent = document.createTextNode('hi');
            newDiv.appendChild(newContent);
            document.body.insertAdjacentElement('beforeend', newDiv);

        }

        function sendForm() {

            // Assignment 3
            // Create an object with the data from the form (title and content)

            const formData = {
                title: document.getElementById('title').value,
                content: document.getElementById('content').value,
                
            }


            // Post the data to http://localhost/api/article using fetch
            fetch('http://localhost/api/article', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(formData)
            }).then(response=>{
                loadData();
                console.log(response);
            })
            // (Optional) Reload the articles on the page afterward
        }

        loadData();
    </script>
</body>

</html>